<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.ui.view" id="view_request_request_form">
        <field name="model">request.request</field>
        <field name="arch" type="xml">
            <form>
                <field name="id" invisible="1"/>
                <field name="use_timesheet" invisible="1"/>
                <field name="classifier_id" invisible="1"/>
                <field name="timesheet_start_status" invisible="1"/>
                <field name="closed" invisible="1"/>
                <field name="can_be_closed" invisible="1"/>
                <field name="is_favourite" invisible="1"/>
                <field name="is_new_request" invisible="1"/>
                <field name="can_change_assignee" invisible="1"/>
                <field name="can_change_responsible" invisible="1"/>
                <field name="can_change_request_text" invisible="1"/>
                <field name="can_change_author" invisible="1"/>
                <field name="can_change_category" invisible="1"/>
                <field name="can_change_deadline" invisible="1"/>
                <field name="tag_ids_domain" invisible="1"/>
                <header>
                    <div class="stage_route_out_wrapper">
                        <field name="stage_route_out_json" widget="stage_route_out_widget"/>
                    </div>
                    <field name="stage_id" widget="statusbar"
                           required="0"
                           readonly="True"
                           domain="[('id', '=', stage_id)]"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_button_show_subrequests"
                                type="object"
                                class="oe_stat_button" icon="fa-sitemap">
                            <field string="Subrequests" name="child_count"
                                   widget="statinfo"/>
                        </button>
                        <button name="action_request_request_diagram"
                                type="object"
                                string="View Flow"
                                class="oe_stat_button"
                                icon="fa-code-fork">
                        </button>
                    </div>
                    <div name="title" class="oe_title request_title">
                        <div style=" display: flex; align-items: center;">
                            <div class="mr16" invisible="is_priority_complex == False">
                                <div>
                                    <span class="field-icon fa fa-star-half-empty oe_inline"
                                        title="Impact"
                                        aria-label="Impact"
                                        style="margin-right: 12px;"/>
                                    <field name="impact" widget="priority" class="mb0"/>
                                </div>
                                <div>
                                    <span class="field-icon fa fa-clock-o oe_inline"
                                        title="Urgency"
                                        aria-label="Urgency"
                                        style="margin-right: 12px;"/>
                                    <field name="urgency" widget="priority"/>
                                </div>
                            </div>
                            <div>
                                <span class="fa fa-arrow-right mr16"
                                      title="Urgency and Impact converted to Priority"
                                      invisible="is_priority_complex == False or id == False"/>
                                <field name="is_priority_complex" invisible="1"/>
                                <field name="priority"
                                    widget="priority"
                                    readonly="is_priority_complex == True"
                                />
                            </div>
                            <div name="title-button-favorite">
                                <button name="toggle_favourite" type="object" class="btn btn-link btn-request-favourite"
                                        invisible="is_favourite == True" style="padding: 0;">
                                    <i class="fa fa-bookmark-o fa-2x" style="color: #777;" title="Add to favourites"/>
                                </button>
                                <button name="toggle_favourite" type="object" class="btn btn-link btn-request-favourite"
                                        invisible="not is_favourite" style="padding: 0;">
                                    <i class="fa fa-bookmark fa-2x" style="color: #f0ad4e;"
                                       title="Remove from favourites"/>
                                </button>
                            </div>
                        </div>
                        <h2 name="header_name">
                            <span invisible="parent_id == False">
                                <field name="parent_id"
                                       placeholder="Parent..."/>
                                <span class="ml4 mr4">/</span>
                            </span>
                            <field name="name"/>
                            <field name="kanban_state"
                                   widget="state_selection"
                                   class="request-kanban-state ml8"/>
                        </h2>
                        <h2 name="header_name">
                            <field name="title" readonly="(id != False and (closed == True or can_change_request_text == False))" class="w-100"/>
                        </h2>
                        <field name="tag_ids"
                               options="{'color_field': 'color'}"
                               domain="tag_ids_domain"
                               widget="many2many_tags"
                               placeholder="Tags..."
                               class="oe_inline"
                               nolabel="1"
                               context="{'default_model': 'request.request'}"/>
                    </div>
                    <group name="request_head_info" class="request-head-info">
                        <group name="request_head_info_left" class="request-head-info-left">
                            <field name="can_change_service" invisible="1"
                                   groups="generic_request.group_request_use_services"/>
                            <field name="service_id_domain" invisible="1"
                                   groups="generic_request.group_request_use_services"/>
                            <div colspan="2" name="header_service"
                                 class="request-head-info-item"
                                 groups="generic_request.group_request_use_services">
                                <span class="field-with-icon">
                                    <span class="field-icon fa fa-square-o oe_inline"
                                          title="Service"/>
                                    <div groups="generic_request.group_request_use_service_groups"
                                         invisible="service_id_group == False">
                                        <field name="service_id_group"
                                               readonly="1"
                                               class="oe_inline w_auto"
                                               groups="generic_request.group_request_use_service_groups"/>
                                        <span class="mr4 ml4">/</span>
                                    </div>
                                    <field name="service_id" placeholder="Service..."
                                           readonly="id != False and can_change_service == False"
                                           options="{'no_create': true, 'no_quick_create': true}"
                                           domain="service_id_domain"
                                           class="oe_inline w_auto"/>
                                </span>
                            </div>
                            <div colspan="2" name="header_category" class="request-head-info-item">
                                <span class="field-with-icon">
                                    <span class="field-icon fa fa-bars oe_inline"
                                        title="Category"
                                        aria-label="Category"/>
                                    <field name="category_id_domain" invisible="1"/>
                                    <field name="category_id" placeholder="Category..."
                                        readonly="id != False and can_change_category == False"
                                        options="{'no_create': true, 'no_quick_create': true}"
                                        domain="category_id_domain"
                                        class="oe_inline"/>
                                </span>
                            </div>
                            <div colspan="2" name="header_type" class="request-head-info-item">
                                <span class="field-with-icon">
                                    <span class="field-icon fa fa-hashtag oe_inline"
                                        title="Type"
                                        aria-label="Type"/>
                                    <field name="type_id_domain" invisible="1"/>
                                    <field name="type_id" placeholder="Type..."
                                        readonly="id != False"
                                        domain="type_id_domain"
                                        options="{'no_create': true, 'no_quick_create': true}"
                                        class="oe_inline"/>
                                </span>
                            </div>
                            <div colspan="2" name="header_kind"
                                 class="request-head-info-item"
                                 groups="generic_request.group_request_use_kind">
                                <span class="field-with-icon" invisible="kind_id == False">
                                    <span class="field-icon fa fa-square oe_inline"
                                        title="Kind"
                                        aria-label="Kind"/>
                                    <field name="kind_id" placeholder="Kind..."
                                        options="{'no_create': true, 'no_quick_create': true}"
                                        class="oe_inline"/>
                                </span>
                            </div>
                        </group>
                        <group name="request_head_info_right" class="request-head-info-right">
                            <div colspan="2" name="header_time_tracking"
                                 class="request-head-info-item"
                                 invisible="use_timesheet == False">
                                <span class="field-with-icon">
                                    <span class="field-icon fa fa-hourglass-end oe_inline"
                                          title="Tracked time"/>
                                    <field name="timesheet_progress"
                                           widget="progressbar"
                                           string="Progress"
                                           class="w_auto"
                                           invisible="timesheet_planned_amount == 0"/>
                                    <field name="timesheet_amount"
                                           widget="float_time"
                                           class="oe_inline w_auto mr4 ml4"/>
                                    of
                                    <field name="timesheet_planned_amount"
                                           widget="float_time"
                                           class="oe_inline w_auto mr4 ml4 request-timesheet-planned-amount"/>
                                    Hours
                                    <span class="request-timesheet-splitter"
                                          invisible="timesheet_planned_amount != 0"/>
                                    <button name="action_start_work"
                                            type="object"
                                            icon="fa-play"
                                            title="Start"
                                            class="btn-sm btn-success ml4"
                                            invisible="timesheet_start_status == 'started'"/>
                                    <button name="action_stop_work"
                                            type="object"
                                            icon="fa-stop"
                                            title="Stop"
                                            class="btn-sm btn-warning ml4"
                                            invisible="timesheet_start_status == 'not-started' or id == False"/>
                                </span>
                            </div>
                            <div colspan="2" name="header_deadline" class="request-head-info-item">
                                <field name="deadline_state" invisible="1"/>
                                <field name="deadline_format" invisible="1"/>
                                <span class="field-with-icon">
                                    <span class="field-icon fa fa-clock-o text-success oe_inline"
                                          title="Deadline"
                                          invisible="deadline_state != 'ok'"/>
                                    <span class="field-icon fa fa-clock-o text-warning oe_inline"
                                          title="Deadline"
                                          invisible="deadline_state != 'today'"/>
                                    <span class="field-icon fa fa-clock-o text-danger oe_inline"
                                          title="Deadline"
                                          invisible="deadline_state != 'overdue'"/>
                                    <span class="field-icon fa fa-clock-o oe_inline"
                                          title="Deadline"
                                          invisible="deadline_state != False"/>
                                    <field name="deadline_date"
                                           readonly="can_change_deadline == False"
                                           invisible="deadline_format == 'datetime'"
                                           class="oe_inline"/>
                                    <field name="deadline_date_dt"
                                           readonly="can_change_deadline == False"
                                           invisible="deadline_format == 'date'"
                                           class="oe_inline"/>
                                </span>
                            </div>
                        </group>
                    </group>
                    <notebook class="request-notebook">
                        <page string="Request" name="page_request">
                            <field name="note_html" invisible="note_html == False or id != False"/>
                            <div class="request-separator request-separator-info"
                                 invisible="note_html == False or id != False">
                                <span class="request-separator-text">Info</span>
                            </div>
                            <group name="group_author" class="request-author-and-partner mb0">
                                <group class="mb0 mt0">
                                    <label for="author_id"/>
                                    <div name="div_author" class="request-partner-author-field o_row">
                                        <field name="author_id"
                                               placeholder="Author..."
                                               readonly="can_change_author == False"/>
                                        <span name="span_request_author_stat">
                                            <button name="action_show_related_author_requests_opened"
                                                    type="object"
                                                    class="btn btn-sm btn-secondary"
                                                    title="Open requests by same author"
                                                    invisible="author_id == False or author_related_request_open_count != 0">
                                                <field name="author_related_request_open_count"/>
                                            </button>
                                            <button name="action_show_related_author_requests_opened"
                                                    type="object"
                                                    class="btn btn-sm btn-outline-danger"
                                                    title="Open requests by same author"
                                                    invisible="author_id == False or author_related_request_open_count == 0">
                                                <field name="author_related_request_open_count"/>
                                            </button>
                                            <button name="action_show_related_author_requests_closed"
                                                    type="object"
                                                    class="btn btn-sm btn-secondary btn-outline-dark ml4"
                                                    title="Closed requests by same author"
                                                    invisible="author_id == False">
                                                <field name="author_related_request_closed_count"/>
                                            </button>
                                        </span>
                                    </div>
                                    <field name="author_name"
                                           invisible="author_id != False or author_name == False" />
                                    <field name="author_phone"
                                           invisible="author_id != False or author_phone == False" />
                                </group>
                                <group name="group_partner" class="mb0 mt0">
                                    <label for="partner_id"/>
                                    <div name="div_partner" class="request-partner-author-field o_row">
                                        <field name="partner_id"
                                               placeholder="Related partner..."/>
                                        <span name="span_request_partner_stat">
                                            <button name="action_show_related_partner_requests_opened"
                                                    type="object"
                                                    class="btn btn-sm btn-secondary"
                                                    title="Open requests by same partner"
                                                    invisible="partner_id == False or partner_related_request_open_count != 0">
                                                <field name="partner_related_request_open_count"/>
                                            </button>
                                            <button name="action_show_related_partner_requests_opened"
                                                    type="object"
                                                    class="btn btn-sm btn-outline-danger"
                                                    title="Open requests by same partner"
                                                    invisible="partner_id == False or partner_related_request_open_count == 0">
                                                <field name="partner_related_request_open_count"/>
                                            </button>
                                            <button name="action_show_related_partner_requests_closed"
                                                    type="object"
                                                    class="btn btn-sm btn-secondary btn-outline-dark ml4"
                                                    title="Closed requests by same partner"
                                                    invisible="partner_id == False">
                                                <field name="partner_related_request_closed_count"/>
                                            </button>
                                        </span>
                                    </div>
                                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                                </group>
                            </group>
                            <div class="request-separator request-separator-request-text mb8" name="request_text_separator">
                                <span class="request-separator-text">Request</span>
                            </div>
                            <field name="request_text"
                                   colspan="4"
                                   readonly="(id != False and (closed == True or can_change_request_text == False))"/>
                            <div class="request-separator request-separator-request-response"
                                 name="request_response_separator"
                                 invisible="response_text == False">
                                <span class="request-separator-text">Response</span>
                            </div>
                            <field name="response_text"
                                   colspan="4"
                                   readonly="1"
                                   invisible="response_text == False"/>
                            <div class="request-separator request-separator-request-response"
                                 name="request_response_separator"
                                 invisible="response_attachment_ids == []">
                                <span class="request-separator-text">Response attachments</span>
                            </div>
                            <field name="response_attachment_ids"
                                   widget="many2many_binary"
                                   readonly="1"/>
                        </page>
                        <page name="page_internal_note" string="Internal notes">
                            <div class="alert alert-info" role="status" colspan="2">
                                <p>
                                    This is the place to keep internal notes on request,
                                    to avoid need to search for info in long discussions in chatter.
                                </p>
                                <p>
                                    The content of this field is visible only in internal interface.
                                </p>
                            </div>
                            <field name="internal_note_text"/>
                        </page>
                        <page string="Time log" name ="page_timelog" invisible="use_timesheet == False">
                            <field name="timesheet_line_ids">
                                <tree editable="bottom">
                                    <field name="is_description_required" column_invisible="1" readonly="1"/>
                                    <field name="date_start" column_invisible="1" readonly="1"/>
                                    <field name="date_end" column_invisible="1" readonly="1"/>
                                    <field name="activity_id" required="1"/>
                                    <field name="date"/>
                                    <field name="user_id"/>
                                    <field name="description"
                                           required="is_description_required == True"/>
                                    <field name="amount"
                                           required="1"
                                           widget="float_time"
                                           string="Duration (Hours)"
                                           sum="Total Duration (Hours)"/>
                                </tree>
                            </field>
                            <group name="group_time_log_footer" class="mt0">
                                <group class="oe_subtotal_footer oe_right mt0">
                                    <field name="timesheet_amount" widget="float_time" readonly="1"/>
                                    <field name="timesheet_remaining_amount" widget="float_time"
                                           class="oe_subtotal_footer_separator" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="Help"
                              name="page_help"
                              invisible="((help_html == False or help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;') and (stage_help_html == False or stage_help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;')) and (category_help_html == False or category_help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;')">
                            <separator string="Stage"
                                       colspan="4"
                                       invisible="stage_help_html == False or stage_help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;'"/>
                            <field colspan="4"
                                   name="stage_help_html"
                                   invisible="stage_help_html == False or stage_help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;'"/>

                            <separator string="Category"
                                       colspan="4"
                                       invisible="category_help_html == False or category_help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;'"/>
                            <field colspan="4"
                                   name="category_help_html"
                                   invisible="category_help_html == False or category_help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;'"/>

                            <separator string="Type"
                                       colspan="4"
                                       invisible="help_html == False or help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;'"/>
                            <field colspan="4"
                                   name="help_html"
                                   invisible="help_html == False or help_html == '&lt;p&gt;&lt;br&gt;&lt;/p&gt;'"/>
                        </page>
                        <page string="Instruction"
                              name="page_instruction"
                              invisible="instruction_visible == False">
                            <field name="instruction_visible" invisible="1"/>
                            <field colspan="4" name="instruction_html"/>
                        </page>
                        <page string="Other" name="page_other">
                            <group>
                                <group name="group_info_left">
                                    <field name="email_from"/>
                                    <field name="email_cc"/>
                                    <field name="email_subject"/>
                                    <field name="channel_id" widget="many2one"/>
                                    <field name="service_level_id" groups="generic_service.group_use_service_level"/>
                                </group>

                                <group name="group_info_right"/>
                            </group>
                        </page>
                        <page string="Technical"
                              name="page_technical"
                              groups="base.group_no_one">
                            <group>
                                <group name="group_tech_links" col="1">
                                    <button name="action_show_related_system_events"
                                            type="object"
                                            class="oe_link"
                                            icon="fa-bell"
                                            groups="generic_request.group_request_manager">
                                        <field name="generic_event_count"
                                               widget="statinfo"
                                               string="Request Events"/>
                                    </button>
                                </group>
                            </group>
                            <group name="group_classifier" col="1">
                                <field name="classifier_id"/>
                            </group>
                        </page>
                    </notebook>
                    <div class="row mt8" name="request_user_info_footer">
                        <div class="col-md-3"
                             name="request_footer__creator">
                            <div><label for="date_created" string="Created"/></div>
                            <div>
                                <i title="Date Created"
                                   class="fa fa-calendar mr4"/>
                                <field name="date_created"/>
                            </div>
                            <div>
                                <i class="fa fa-user mr4"
                                   title="Created by user"/>
                                <field name="created_by_id"
                                       class="d-inline-block"/>
                            </div>
                        </div>
                        <div class="col-md-3"
                             name="request_footer__responsible">
                            <div>
                                <span invisible="responsible_id == False">
                                    <label for="date_set_responsible" string="Responsible"/>
                                </span>
                                <span name="request_set_response_button"
                                      invisible="closed == True or can_change_responsible == False or responsible_id != False or id == False">
                                    <button name="action_request_set_responsible"
                                            type="object"
                                            string="Set responsible"
                                            class="oe_link"
                                            style="padding: 0px 0px;"/></span>
                                <span name="request_change_responsible_button"
                                      invisible="can_change_responsible == False or responsible_id == False">
                                    <button name="action_request_set_responsible"
                                            type="object"
                                            string="Change"
                                            class="oe_link"
                                            style="padding: 0px 0px;"/></span>
                            </div>
                            <div invisible="responsible_id != False">
                                <button name="action_request_responsible_to_me"
                                        type="object"
                                        invisible="closed == True or can_change_responsible == False or responsible_id != False or id == False"
                                        string="Set responsibility on me"
                                        class="oe_link"
                                        style="padding: 0px 0px;"/>
                            </div>
                            <div>
                                <i title="Date set responsible"
                                   class="fa fa-calendar mr4" invisible="date_set_responsible == False"/>
                                <field name="date_set_responsible"/>
                            </div>
                            <div invisible="responsible_id == False">
                                 <i class="fa fa-user mr4"
                                    title="Responsible"/>
                                 <field name="responsible_id"
                                        readonly="1"
                                        widget="m2o_info"
                                        class="d-inline-block"
                                        options="{'info_method': 'request_helper_m2o_info'}"/>
                            </div>
                        </div>
                        <div class="col-md-3"
                             name="request_footer__moved_by"
                             invisible="date_moved == False"
                             groups="base.group_no_one">
                            <div><label for="date_moved" string="Moved"/></div>
                            <div>
                                <i title="Date Created"
                                   class="fa fa-calendar mr4"/>
                                <field name="date_moved"/>
                            </div>
                            <div>
                                <i class="fa fa-user mr4"
                                   title="Moved by user"/>
                                <field name="moved_by_id"
                                       class="d-inline-block"/></div>
                        </div>
                        <div class="col-md-3"
                             name="request_footer__assigned">
                            <div>
                                <span invisible="user_id == False">
                                    <label for="date_assigned" string="Assigned"/>
                                </span>
                                <span name="request_assign_button"
                                      invisible="closed == True or can_change_assignee == False or user_id != False or id == False">
                                    <button name="action_request_assign"
                                            type="object"
                                            string="Assign"
                                            class="oe_link"
                                            style="padding: 0px 0px;"/></span>
                                <span name="request_reassign_button"
                                      invisible="can_change_assignee == False or user_id == False">
                                    <button name="action_request_assign"
                                            type="object"
                                            string="Reassign"
                                            class="oe_link"
                                            style="padding: 0px 0px;"/></span>
                            </div>
                            <div invisible="user_id != False">
                                <button name="action_request_assign_to_me"
                                        type="object"
                                        invisible="closed == True or can_change_assignee == False or user_id != False or id == False"
                                        string="Assign to me"
                                        class="oe_link"
                                        style="padding: 0px 0px;"/>
                            </div>
                            <div>
                                <i title="Date Assigned"
                                   class="fa fa-calendar mr4" invisible="date_assigned == False"/>
                                <field name="date_assigned"/>
                            </div>
                            <div invisible="user_id == False">
                                 <i class="fa fa-user mr4"
                                    title="Assignee"/>
                                 <field name="user_id"
                                        readonly="1"
                                        class="d-inline-block"/>
                            </div>
                        </div>
                        <div class="col-md-3"
                             name="request_footer__closed"
                             invisible="date_closed == False">
                            <div><label for="date_closed" string="Closed"/></div>
                            <div>
                                <i title="Date Closed"
                                   class="fa fa-calendar mr4"/>
                                <field name="date_closed"/>
                            </div>
                            <div>
                                <i class="fa fa-user mr4"
                                   title="Closed by user"/>
                                <field name="closed_by_id"
                                       class="d-inline-block"/>
                            </div>
                        </div>
                    </div>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_request_tree">
        <field name="model">request.request</field>
        <field name="arch" type="xml">
            <tree decoration-bf="message_needaction==True">
                <field name="deadline_state"
                       column_invisible="1"/>
                <field name="message_needaction"
                       column_invisible="1"/>
                <field name="is_priority_complex"
                       column_invisible='1'/>
                <field name="deadline_format"
                       column_invisible='1'/>
                <field name="stage_bg_color"
                       column_invisible="1"/>
                <field name="stage_label_color"
                       column_invisible="1"/>
                <field name="name" />
                <field name="service_id"
                       optional="show"
                       groups="generic_request.group_request_use_services"/>
                <field name="service_id_group"
                       optional="show"
                       groups="generic_request.group_request_use_service_groups"/>
                <field name="type_id"
                       optional="show"/>
                <field name="category_id"
                       optional="show"/>
                <field name="parent_id"
                       optional="show"/>
                <field name="partner_id"
                       optional="show"/>
                <field name="author_id"
                       optional="show"/>
                <field name="user_id"
                       optional="show"/>
                <field name="responsible_id"
                       optional="show"/>
                <field name="request_text_sample"
                       string="Description"
                       class="request-tree-line-clamp"
                       optional="show"/>
                <field name="date_created"
                       optional="show"/>
                <field name="date_closed"
                       optional="show"/>
                <field name="deadline_date"
                       string="Deadline"
                       options="{&quot;field_label_color_expression&quot;: &quot;#dc3545:deadline_state == 'overdue'; #28a745:deadline_state == 'ok'; #ffc107:deadline_state == 'today'&quot;}"
                       invisible="deadline_format == 'datetime'"
                       optional="show"/>
                <field name="deadline_date_dt"
                       string="Deadline datetime"
                       options="{&quot;field_label_color_expression&quot;: &quot;#dc3545:deadline_state == 'overdue'; #28a745:deadline_state == 'ok'; #ffc107:deadline_state == 'today'&quot;}"
                       invisible="deadline_format == 'date'"
                       optional="show"/>
                <field name="stage_id"
                       options="{'field_bg_color': 'stage_bg_color', 'field_label_color': 'stage_label_color'}"
                       optional="show"/>
                <field name="kanban_state"
                       widget="state_selection"
                       optional="show"/>
                <field name="service_level_id"
                       optional="show"
                       groups="generic_service.group_use_service_level"/>
                <field name="tag_ids"
                       options="{'color_field': 'color'}"
                       widget="many2many_tags"
                       placeholder="Tags..."
                       context="{'default_model': 'request.request'}"
                       optional="show"/>
                <field name="use_timesheet"
                       column_invisible="1"/>
                <field name="timesheet_start_status"
                       column_invisible="1"/>
                <button name="action_start_work"
                        type="object"
                        string="Start"
                        icon="fa-play-circle"
                        class="text-success"
                        invisible="use_timesheet == False or timesheet_start_status == 'started'"/>
                <button name="action_stop_work"
                        type="object"
                        string="Stop"
                        icon="fa-stop-circle"
                        class="text-warning"
                        invisible="use_timesheet == False or timesheet_start_status == 'not-started'"/>
                <field name="priority"
                       widget="priority"
                       readonly="is_priority_complex == True"
                       optional="show"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_request_kanban">
        <field name="model">request.request</field>
        <field name="arch" type="xml">
            <kanban edit="false" delete="false" group_create="false" quick_create="false" group_edit="false" group_delete="false"
                    class="request-kanban-view">
                <field name="name"/>
                <field name="use_timesheet"/>
                <field name="timesheet_start_status"/>
                <field name="service_id"
                       groups="generic_request.group_request_use_services"/>
                <field name="type_id"/>
                <field name="type_color"/>
                <field name="kind_id"
                       groups="generic_request.group_request_use_kind"/>
                <field name="category_id"/>
                <field name="created_by_id"/>
                <field name="user_id"/>
                <field name="date_created"/>
                <field name="date_assigned"/>
                <field name="date_closed"/>
                <field name="closed_by_id"/>
                <field name="closed"/>
                <field name="stage_id"/>
                <field name="stage_bg_color"/>
                <field name="stage_label_color"/>
                <field name="request_text_sample"/>
                <field name="activity_ids"/>
                <field name="activity_state"/>
                <field name="partner_id"/>
                <field name="author_id"/>
                <field name="deadline_date"/>
                <field name="deadline_date_dt"/>
                <field name="deadline_state"/>
                <field name="deadline_format"/>
                <field name="kanban_state"/>
                <field name="parent_id"></field>
                <field name="child_count"></field>
                <field name="favourite_user_ids"></field>
                <field name="is_favourite"></field>

                <field name="message_follower_ids"/>
                <field name="message_discussion_ids"/>
                <field name="message_needaction"/>
                <field name="message_needaction_counter"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_request_kanban"
                             t-att-style="record.closed.raw_value ? 'background-color:rgba(242,242,242,1)' : 'rgba(255,255,255,1)'">
                            <div t-attf-style="background-color: {{record.type_color.raw_value}}"
                                 name="header"
                                 class="o_request_kanban_header">
                                <div name="title_box" class="o_header_title_box">
                                    <div t-if="record.parent_id.value"
                                         class="o_header_box_item"
                                         name="kanban_action_open_parent">
                                        <a type="object"
                                           name="action_open_parent">
                                            <span><field
                                                    name="parent_id"/><span>
                                                / </span></span>
                                        </a>
                                    </div>
                                    <div name="title" class="o_header_title o_header_box_item">
                                        <span><field name="name"/></span>
                                    </div>
                                    <div name="activities_box" class="o_header_title o_header_box_item">
                                        <span><field name="activity_ids" widget="kanban_activity"/></span>
                                    </div>
                                    <div class="o_header_box_item" name="kanban_action_start_work">
                                        <a name="action_start_work"
                                           type="object"
                                           title="Start"
                                           class="fa fa-lg fa-play-circle text-success"
                                           invisible="use_timesheet == False or timesheet_start_status == 'started'"/>
                                        <a name="action_stop_work"
                                           type="object"
                                           title="Stop"
                                           class="fa fa-lg fa-stop-circle text-warning"
                                           invisible="use_timesheet == False or timesheet_start_status == 'not-started'"/>
                                    </div>
                                    <div name="priority_box" class="o_header_box_item">
                                        <field name="is_priority_complex" invisible='True'/>
                                        <field name="priority"
                                               widget="priority"
                                               readonly="is_priority_complex == True"
                                        />
                                    </div>
                                </div>
                                <div name="icons_info" class="o_header_icons_info">
                                    <span t-if="record.message_needaction.raw_value"
                                          class="icon"
                                          name="kanban_messages_icon">
                                        <span title='Messages' class='fa fa-comments mr4'></span>
                                        <span style="font-weight: bold"
                                              title="You have unread messages related to this request.">
                                             <t t-esc="record.message_needaction_counter.raw_value"/>
                                        </span>
                                    </span>
                                    <span t-if="record.child_count.raw_value"
                                          name="kanban_icon_sebrequests"
                                          class="icon">
                                        <span title='Subrequests'
                                              class='fa fa-sitemap mr4'></span>
                                        <t t-esc="record.child_count.raw_value"/>
                                    </span>
                                </div>
                                <div name="right_info" class="o_header_right_info">
                                    <div name="right_info_favourite" style="margin-right: 5px;">
                                        <a name="toggle_favourite" type="object" style="cursor: pointer;">
                                            <field name="favourite_user_ids" widget="many2many_tags" invisible="1"/>
                                            <field name="is_favourite" invisible="1"/>
                                            <i t-if="record.is_favourite.raw_value" class="fa fa-bookmark"
                                               title="Remove from favourites" style="color: #f0ad4e;"/>
                                            <i t-else="" class="fa fa-bookmark-o" title="Add to favourites"
                                               style="color: #777;"/>
                                        </a>
                                    </div>
                                    <div name="right_info_kanban_state">
                                        <field name="kanban_state"
                                               widget="state_selection"/>
                                    </div>
                                    <div name="right_info_stage"
                                         class="o_header_stage"
                                         t-attf-style="background-color: {{record.stage_bg_color.raw_value}}">
                                        <span t-attf-style="color: {{record.stage_label_color.raw_value}}">
                                            <field name="stage_id"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="request_kanban_tags_and_date" name="kanban_tags">
                                <div class="request_kanban_tags" title="Tags">
                                    <field name="tag_ids"
                                           widget="many2many_tags"
                                           options="{'color_field': 'color'}"/>
                                </div>
                                <div class="request_kanban_date_created">
                                    <span class="fa fa-calendar" title="Date created">
                                        <field name="date_created"/>
                                    </span>
                                </div>
                            </div>
                            <div class="o_request_kanban_content" name="kanban_content">
                                <div class="o_request_kanban_info o_request_kanban_row">
                                    <div name="request_kanban_info_left" class="o_request_kanban_info_left">
                                        <div groups="generic_request.group_request_use_services">
                                            <span class="text-muted" title="Service">
                                                <span class="fa fa-square-o mr4"/>
                                                <t groups="generic_request.group_request_use_service_groups">
                                                    <t t-if="record.service_id_group.raw_value">
                                                        <field name="service_id_group"/>
                                                        <a>/</a>
                                                    </t>
                                                </t>
                                                <t t-if="record.service_id.raw_value">
                                                    <field name="service_id"/>
                                                </t>
                                                <t t-if="!record.service_id.raw_value">
                                                    <span>Undefined</span>
                                                </t>
                                            </span>
                                        </div>
                                        <div>
                                            <span class="" title="Category" name="kanban_request_category">
                                                <span class="fa fa-bars mr4"/>
                                                <t t-if="record.category_id.raw_value">
                                                    <field name="category_id"/>
                                                </t>
                                                <t t-if="!record.category_id.raw_value">
                                                    <span class="text-muted">Undefined</span>
                                                </t>
                                            </span>
                                        </div>
                                        <div>
                                            <span class="text-muted" title="Type" name="kanban_request_type">
                                                <span class="fa fa-hashtag mr4"/>
                                                <field name="type_id"/>
                                            </span>
                                        </div>
                                        <div groups="generic_request.group_request_use_kind">
                                            <span class="" title="Kind" name="kanban_request_kind">
                                                <span class="fa fa-square mr4"/>
                                                <t t-if="record.kind_id.raw_value">
                                                    <field name="kind_id"/>
                                                </t>
                                                <t t-if="!record.kind_id.raw_value">
                                                    <span class="text-muted">Undefined</span>
                                                </t>
                                            </span>
                                        </div>
                                    </div>
                                    <div name="request_kanban_info_right" class="o_request_kanban_info_right">
                                        <div t-if="record.deadline_date.raw_value" name="kanban_deadline_date">
                                            <span class="" title="Deadline">
                                                <span t-if="record.deadline_state.raw_value == 'ok'"
                                                    class="text-success fa fa-clock-o mr4"/>
                                                <span t-if="record.deadline_state.raw_value == 'today'"
                                                    class="text-warning fa fa-clock-o mr4"/>
                                                <span t-if="record.deadline_state.raw_value == 'overdue'"
                                                    class="text-danger fa fa-clock-o mr4"/>
                                                <field name="deadline_date" invisible="deadline_format == 'datetime'"/>
                                                <field name="deadline_date_dt" invisible="deadline_format == 'date'"/>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div name="request_kanban_info_main"
                                     class="o_request_kanban_info_main o_request_kanban_row">
                                    <div name="request_kanban_info_main_left" class="">
                                        <span>
                                            <span class="fa fa-vcard-o" title="Author"/>
                                            <span title="Author">
                                                <field t-if="record.author_id.raw_value"
                                                       name="author_id"/>
                                                <span t-else="" class="text-muted">No author selected</span>
                                            </span>
                                        </span>
                                        <span>
                                            <span class="fa fa-vcard" title="Partner"/>
                                            <span title="Partner">
                                                <field t-if="record.partner_id.raw_value"
                                                       name="partner_id"/>
                                                <span t-else="" class="text-muted">No partner selected</span>
                                            </span>
                                        </span>
                                    </div>
                                    <div name="request_kanban_info_main_right" class="">
                                        <span>
                                            <span class="fa fa-user" title="Assignee"/>
                                            <span title="Assignee">
                                                <field t-if="record.user_id.raw_value"
                                                       name="user_id"/>
                                                <span t-else="" class="text-muted">No user assigned</span>
                                            </span>
                                        </span>
                                    </div>
                                </div>
                             <div class="o_request_kanban_row">
                              <div class="o_partner_icon mr8" name="kanban_partner_icon">
                                <t t-if="record.partner_id.raw_value">
                                    <div>
                                        <a type="open">
                                            <img t-att-src="kanban_image('res.partner', 'image_128', record.partner_id.raw_value)"
                                                 t-att-title="record.partner_id.value"
                                                 t-att-alt="record.partner_id.value"
                                                 class="oe_kanban_image"/>
                                        </a>
                                    </div>
                                </t>
                              </div>
                              <div name="request_text" class="o_request_kanban_text">
                                  <field name="request_text_sample"/>
                              </div>
                            </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_request_search">
        <field name="model">request.request</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="display_name" string="All fields"
                       filter_domain="['|', '|', '|', '|', '|', '|', '|', '|', '|',
                       ('name', 'ilike', self),
                       ('request_text', 'ilike', self),
                       ('response_text', 'ilike', self),
                       ('internal_note_text', 'ilike', self),
                       ('author_id.phone', 'ilike', self),
                       ('author_id.mobile', 'ilike', self),
                       ('author_id.name', 'ilike', self),
                       ('partner_id.phone', 'ilike', self),
                       ('partner_id.mobile', 'ilike', self),
                       ('partner_id.name', 'ilike', self)]"/>
                <field name="service_id"
                       groups="generic_request.group_request_use_services"/>
                <field name="service_id_group"
                       groups="generic_request.group_request_use_service_groups"/>
                <field name="service_level_id" groups="generic_service.group_use_service_level"/>
                <field name="type_id"/>
                <field name="parent_id"/>
                <field name="kind_id" groups="generic_request.group_request_use_kind"/>
                <field name="category_id"/>
                <field name="stage_type_id"/>
                <field name="partner_id"/>
                <field name="author_id"/>
                <field name="user_id"/>
                <field name="responsible_id"/>
                <field name="email_subject"/>
                <field name="is_assigned"/>
                <field name="closed"/>
                <field name="tag_ids"/>
                <field name="date_24h_from_creation"/>
                <field name="search_tag_id"/>
                <field name="search_no_tag_id"/>
                <field name="message_ids"
                       filter_domain="['|', ('message_ids.body', 'ilike', self), ('message_ids.subject', 'ilike', self)]"/>

                <filter name="filter_archived"
                        string="Archived"
                        domain="[('active', '=', False)]"/>
                <filter name="filter_active"
                        string="Active"
                        domain="[('active', '=', True)]"/>

                <separator/>
                <filter name="filter_closed"
                        string="Closed"
                        domain="[('closed', '=', True)]"/>
                <filter name="filter_closed_today"
                        string="Closed Today"
                        domain="[
                            ('date_closed', '&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59))),
                            ('date_closed','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))
                            ]"/>

                <separator/>
                <filter name="filter_favourite"
                        string="My favorite requests"
                        domain="[('favourite_user_ids', 'in', [uid])]"/>

                <separator/>
                <filter name="filter_open"
                        string="Open"
                        domain="[('closed', '=', False)]"/>

                <separator/>
                <filter name="filter_unassigned"
                        string="Unassigned"
                        domain="[('user_id', '=', False)]"/>
                <filter name="filter_assigned_to_me"
                        string="Assigned to me"
                        domain="[('user_id', '=', uid)]"/>
                <filter name="filter_created_by_me"
                        string="My requests"
                        domain="[('created_by_id', '=', uid)]"/>
                <separator/>
                <filter name="filter_noresponsible"
                        string="No responsible"
                        domain="[('responsible_id', '=', False)]"/>
                <filter name="filter_responsible_on_me"
                        string="Responsible on Me"
                        domain="[('responsible_id', '=', uid)]"/>
                <separator/>
                <filter name="filter_today"
                        string="Today"
                        domain="[
                            ('date_created', '&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59))),
                            ('date_created','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))
                            ]"/>
                <filter name="filter_24h"
                        string="24 hours"
                        domain="[('date_24h_from_creation','&gt;=', datetime.datetime.now().to_utc())]"/>
                <filter name="filter_week"
                        string="Week"
                        domain="[('date_created', '&gt;=', (datetime.datetime.combine(context_today() - relativedelta(weeks=1), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <filter name="filter_month"
                        string="Month"
                        domain="[('date_created', '&gt;=', (datetime.datetime.combine(context_today() - relativedelta(months=1), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <filter name="filter_year"
                        string="Year"
                        domain="[('date_created', '&gt;=', (datetime.datetime.combine(context_today() - relativedelta(years=1), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <separator/>
                <filter string="Unread Messages"
                        name="message_needaction"
                        domain="[('message_needaction','=',True)]"/>
                <separator/>
                <filter string="Is Subrequest"
                        name="is_subrequest"
                        domain="[('parent_id', '!=', False)]"/>
                <filter string="Not Subrequest"
                        name="not_subrequest"
                        domain="[('parent_id', '=', False)]"/>
                <filter string="Has Subrequests"
                        name="has_subrequest"
                        domain="[('child_ids', '!=', False)]"/>
                <separator/>
                <filter string="Has Service Group"
                        name="has_service_group"
                        domain="[('service_id_group', '!=', False)]"
                        groups="generic_request.group_request_use_service_groups"/>
                <filter string="Not Service Group"
                        name="not_service_group"
                        domain="[('service_id_group', '=', False)]"
                        groups="generic_request.group_request_use_service_groups"/>

                <group name="group_group_by" expand="0" string="Group by...">
                    <filter name="filter_group_by_creation_date"
                            string="Creation date" context="{'group_by': 'date_created'}"/>
                    <filter name="filter_group_by_type"
                            string="Type" context="{'group_by': 'type_id'}"/>
                    <filter name="filter_group_by_kind"
                            string="Kind" context="{'group_by': 'kind_id'}"
                            groups="generic_request.group_request_use_kind"/>
                    <filter name="filter_group_by_category"
                            string="Category" context="{'group_by': 'category_id'}"/>
                    <filter name="filter_group_by_stage"
                            string="Stage" context="{'group_by': 'stage_id'}"/>
                    <filter name="filter_group_by_stage_type"
                            string="Stage Type" context="{'group_by': 'stage_type_id'}"/>
                    <filter name="filter_group_by_partner"
                            string="Partner" context="{'group_by': 'partner_id'}"/>
                    <filter name="filter_group_by_assignee"
                            string="Assignee" context="{'group_by': 'user_id'}"/>
                    <filter name="filter_group_by_responsible"
                            string="Responsible" context="{'group_by': 'responsible_id'}"/>
                    <filter name="filter_group_by_is_assigned"
                            string="Is assigned" context="{'group_by': 'is_assigned'}"/>
                    <filter name="filter_group_by_author"
                            string="Author" context="{'group_by': 'author_id'}"/>
                    <filter name="filter_group_by_created_by"
                            string="Created by" context="{'group_by': 'created_by_id'}"/>
                    <filter name="filter_group_by_is_closed"
                            string="Is closed" context="{'group_by': 'closed'}"/>
                    <filter name="filter_group_by_closed_by"
                            string="Closed by" context="{'group_by': 'closed_by_id'}"/>
                    <filter name="filter_group_by_priority"
                            string="Priority"
                            context="{'group_by': 'priority'}"/>
                    <filter name="filter_group_by_channel"
                            string="Channel"
                            context="{'group_by': 'channel_id'}"/>
                    <filter name="company"
                            string="Company"
                            context="{'group_by':'company_id'}"
                            groups="base.group_multi_company"/>
                    <filter name="filter_group_by_service"
                            string="Service"
                            context="{'group_by': 'service_id'}"
                            groups="generic_request.group_request_use_services"/>
                    <filter name="filter_group_by_service_group"
                            string="Service Group"
                            context="{'group_by': 'service_id_group'}"
                            groups="generic_request.group_request_use_service_groups"/>
                    <filter name="filter_group_by_service_level"
                            string="Service Level"
                            context="{'group_by': 'service_level_id'}"
                            groups="generic_service.group_use_service_level"/>
                </group>
            </search>
        </field>
    </record>
    <record model="ir.ui.view" id="view_request_request_graph">
        <field name="model">request.request</field>
        <field name="arch" type="xml">
            <graph>
                <field name="type_id"/>
                <field name="stage_type_id"/>
            </graph>
        </field>
    </record>
    <record model="ir.ui.view" id="view_request_request_pivot">
        <field name="model">request.request</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="stage_type_id" type="col"/>
                <field name="kind_id" type="row"
                       groups="generic_request.group_request_use_kind"/>
                <field name="type_id" type="row"/>
            </pivot>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_request_window">
        <field name="name">Requests</field>
        <field name="res_model">request.request</field>
        <field name="view_mode">kanban,tree,graph,pivot,form,activity</field>
        <field name="context">{'search_default_filter_open': 1, 'search_default_filter_assigned_to_me': 1, 'search_default_filter_created_by_me': 1, 'search_default_filter_unassigned': 1}</field>
    </record>

    <record id="action_stat_request_count" model="ir.actions.act_window">
        <field name="name">Request Count</field>
        <field name="res_model">request.request</field>
        <field name="view_mode">kanban,tree,graph,pivot,form,activity</field>
    </record>

    <record model="ir.ui.view" id="view_request_request_searchpanel">
        <field name="model">request.request</field>
        <field name="inherit_id" ref="view_request_request_search"/>
        <field name="arch" type="xml">
            <xpath expr="/search/group" position="before">
                <searchpanel groups='generic_request.group_request_show_searchpanel_view'>
                    <field name="service_id" string="Service"
                           groups="generic_request.group_request_use_services"/>
                    <field name="category_id" string="Category"/>
                    <field name="type_id" string="Type"/>
                    <field name="stage_type_id" string="Stage Type"/>
                    <field name="tag_ids" string="Tags" select="multi"
                           domain="[('model_id.model', '=', 'request.request')]"/>
                    <field name="channel_id" string="Channel"/>
                </searchpanel>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_request_request_diagram">
        <field name="model">request.request</field>
        <field name="type">diagram_plus</field>
        <field name="arch" type="xml">
            <diagram_plus auto_layout="false">
                <node object="request.stage"
                      bgcolor="gray:closed"
                      bg_color_field="res_bg_color"
                      fg_color_field="res_label_color"
                      d_position_field="diagram_position">
                </node>
                <arrow object="request.stage.route"
                       source="stage_from_id"
                       destination="stage_to_id"
                       label="['name']">
                </arrow>
            </diagram_plus>
        </field>
    </record>

    <menuitem id="menu_request_type_view"
              name="All Requests"
              parent="menu_request"
              action="action_request_window"
              groups="group_request_user"/>

</odoo>
